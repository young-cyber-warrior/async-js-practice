# –ú–æ–¥—É–ª—å 2: Promises –≤ –¥–µ—Ç–∞–ª—è—Ö

## üéØ –¶–µ–ª—å –º–æ–¥—É–ª—è

–ì–ª—É–±–æ–∫–æ–µ –∏–∑—É—á–µ–Ω–∏–µ Promise API, –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–º–∏—Å–∞–º–∏, —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —É—Ç–∏–ª–∏—Ç –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

---

## üìù –ó–∞–¥–∞—á–∞ 6: Promise.prototype.finally

### –û–ø–∏—Å–∞–Ω–∏–µ
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é `Promise.prototype.finally` –∏ –∏–∑—É—á–∏—Ç—å –µ—ë –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏.

### –£—Å–ª–æ–≤–∏–µ
```javascript
// Promise.prototype.finally –¥–æ–ª–∂–µ–Ω:
// 1. –í—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –∏ –ø—Ä–∏ resolve, –∏ –ø—Ä–∏ reject
// 2. –ù–ï –∏–∑–º–µ–Ω—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∏–ª–∏ –æ—à–∏–±–∫—É –ø—Ä–æ–º–∏—Å–∞
// 3. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å async —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –∫–∞—á–µ—Å—Ç–≤–µ callback'–∞

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
Promise.resolve(42)
    .finally(() => console.log('–û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤'))
    .then(value => console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç:', value)); // 42

Promise.reject(new Error('–û—à–∏–±–∫–∞'))
    .finally(() => console.log('–û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ'))
    .catch(error => console.log('–ü–æ–π–º–∞–ª–∏:', error.message));
```

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
1. –†–µ–∞–ª–∏–∑—É–π—Ç–µ `Promise.prototype.finally` –∫–∞–∫ –ø–æ–ª–∏—Ñ–∏–ª
2. Finally –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ
3. Finally –ù–ï –¥–æ–ª–∂–µ–Ω –∏–∑–º–µ–Ω—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–º–∏—Å–∞
4. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ async —Ñ—É–Ω–∫—Ü–∏–π –≤ finally callback
5. –ï—Å–ª–∏ –≤ finally –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—à–∏–±–∫–∞ - –æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–º–µ–Ω–∏—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
```javascript
if (!Promise.prototype.finally) {
    Promise.prototype.finally = function(callback) {
        // –í–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–¥–µ—Å—å
    };
}
```
---

## üìù –ó–∞–¥–∞—á–∞ 7: Thenable –æ–±—ä–µ–∫—Ç—ã

### –û–ø–∏—Å–∞–Ω–∏–µ
–ò–∑—É—á–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å thenable –æ–±—ä–µ–∫—Ç–∞–º–∏ –∏ —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–µ thenable'—ã.

### –£—Å–ª–æ–≤–∏–µ
```javascript
// Thenable - –æ–±—ä–µ–∫—Ç —Å –º–µ—Ç–æ–¥–æ–º .then()
// Promise.resolve() –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ "—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç" thenable –æ–±—ä–µ–∫—Ç—ã

const thenable = {
    then(onResolve, onReject) {
        setTimeout(() => onResolve('Thenable —Ä–µ–∑—É–ª—å—Ç–∞—Ç'), 100);
    }
};

Promise.resolve(thenable)
    .then(result => console.log(result)); // "Thenable —Ä–µ–∑—É–ª—å—Ç–∞—Ç"
```

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
1. **`createLazyThenable(fn)`** - thenable, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º .then()
   ```javascript
   const lazy = createLazyThenable(() => {
       console.log('–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º .then()');
       return '–õ–µ–Ω–∏–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç';
   });
   
   // –§—É–Ω–∫—Ü–∏—è –ù–ï –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è
   const promise1 = Promise.resolve(lazy);
   
   // –§—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–¥–µ—Å—å
   promise1.then(result => console.log(result));
   ```

2. **`createCancellableThenable(promise)`** - thenable —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ—Ç–º–µ–Ω—ã
   ```javascript
   const cancellable = createCancellableThenable(
       fetch('/api/data')
   );
   
   setTimeout(() => cancellable.cancel(), 1000);
   
   cancellable.then(
       result => console.log('–£—Å–ø–µ—Ö:', result),
       error => console.log('–û—à–∏–±–∫–∞ –∏–ª–∏ –æ—Ç–º–µ–Ω–∞:', error)
   );
   ```

3. **`createRetryableThenable(fn, maxRetries)`** - thenable —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –ø–æ–≤—Ç–æ—Ä–∞–º–∏
   ```javascript
   const retryable = createRetryableThenable(
       () => unreliableAPICall(),
       3
   );
   
   retryable.then(result => console.log(result));
   ```

### –§–∞–π–ª —Ä–µ—à–µ–Ω–∏—è
`solutions/task-07.js`

---

## üìù –ó–∞–¥–∞—á–∞ 8: Promise –∫–æ–º–ø–æ–∑–∏—Ü–∏—è –∏ —Ü–µ–ø–æ—á–∫–∏

### –û–ø–∏—Å–∞–Ω–∏–µ
–°–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ promise chains.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **`pipe(...fns)`** - –∫–æ–º–ø–æ–∑–∏—Ü–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
   ```javascript
   const pipeline = pipe(
       async (x) => x * 2,
       async (x) => x + 1,
       async (x) => `–†–µ–∑—É–ª—å—Ç–∞—Ç: ${x}`
   );
   
   const result = await pipeline(5); // "–†–µ–∑—É–ª—å—Ç–∞—Ç: 11"
   ```

2. **`map(array, asyncFn, concurrency = Infinity)`** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π map —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏
   ```javascript
   const urls = ['/api/1', '/api/2', '/api/3', '/api/4'];
   
   const results = await map(urls, async (url) => {
       return await fetch(url);
   }, 2); // –ú–∞–∫—Å–∏–º—É–º 2 –∑–∞–ø—Ä–æ—Å–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
   ```

3. **`filter(array, asyncPredicate)`** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π filter
   ```javascript
   const users = [1, 2, 3, 4, 5];
   
   const activeUsers = await filter(users, async (userId) => {
       const user = await getUserById(userId);
       return user.isActive;
   });
   ```

4. **`reduce(array, asyncReducer, initialValue)`** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π reduce
   ```javascript
   const files = ['file1.txt', 'file2.txt', 'file3.txt'];
   
   const totalSize = await reduce(files, async (acc, filename) => {
       const stats = await getFileStats(filename);
       return acc + stats.size;
   }, 0);
   ```

5. **`waterfall(tasks)`** - –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å –ø–µ—Ä–µ–¥–∞—á–µ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
   ```javascript
   const result = await waterfall([
       async () => await getUser(1),
       async (user) => await getUserPosts(user.id),
       async (posts) => await getPostComments(posts[0].id)
   ]);
   ```

### –§–∞–π–ª —Ä–µ—à–µ–Ω–∏—è
`solutions/task-08.js`

---

## üìù –ó–∞–¥–∞—á–∞ 9: Promise –º–µ–º–æ–∏–∑–∞—Ü–∏—è

### –û–ø–∏—Å–∞–Ω–∏–µ
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **`memoizeAsync(fn, options)`** - –±–∞–∑–æ–≤–∞—è –º–µ–º–æ–∏–∑–∞—Ü–∏—è
   ```javascript
   const memoized = memoizeAsync(async (userId) => {
       console.log(`–ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userId}`);
       return await fetchUser(userId);
   });
   
   await memoized(1); // –†–µ–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å
   await memoized(1); // –ò–∑ –∫—ç—à–∞
   ```

2. **–û–ø—Ü–∏–∏ –º–µ–º–æ–∏–∑–∞—Ü–∏–∏:**
   - `ttl` - –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫—ç—à–∞ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
   - `maxSize` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫—ç—à–∞ (LRU eviction)
   - `keyGenerator` - —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–µ–π –∫—ç—à–∞
   - `onHit/onMiss` - –∫–æ–ª–ª–±—ç–∫–∏ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

3. **`memoizeWithTTL(fn, ttl)`** - —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —É–¥–∞–ª–µ–Ω–∏–µ–º —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π
   ```javascript
   const cached = memoizeWithTTL(expensiveOperation, 60000); // 1 –º–∏–Ω—É—Ç–∞
   
   await cached('key1'); // –ó–∞–ø—Ä–æ—Å
   await cached('key1'); // –ö—ç—à (–µ—Å–ª–∏ –º–µ–Ω—å—à–µ –º–∏–Ω—É—Ç—ã –ø—Ä–æ—à–ª–æ)
   ```

4. **`memoizeWithInvalidation(fn, invalidationFn)`** - —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏
   ```javascript
   const cached = memoizeWithInvalidation(
       (userId) => fetchUser(userId),
   );
   
   cached.invalidate('user_1'); // –£–¥–∞–ª–∏—Ç—å –∏–∑ –∫—ç—à–∞
   cached.clear(); // –û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫—ç—à
   ```

## üìù –ó–∞–¥–∞—á–∞ 10: Promise –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è

### –û–ø–∏—Å–∞–Ω–∏–µ
–°–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Å–ª–æ–∂–Ω–æ–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–æ–º–∏—Å–æ–≤.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **`PromisePool(concurrency)`** - –ø—É–ª —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å—é
   ```javascript
   const pool = new PromisePool(3);
   
   const promises = urls.map(url => 
       pool.add(() => fetch(url))
   );
   
   const results = await Promise.all(promises);
   ```

2. **`promiseAllWithProgress(promises, onProgress)`** - Promise.all —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º
   ```javascript
   const promises = [
       fetch('/api/1'),
       fetch('/api/2'),
       fetch('/api/3')
   ];
   
   const results = await promiseAllWithProgress(promises, (progress) => {
       console.log(`–í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${progress.completed}/${progress.total}`);
   });
   ```

3. **`promiseRaceWithTimeout(promises, timeout)`** - race —Å —Ç–∞–π–º–∞—É—Ç–æ–º
   ```javascript
   try {
       const result = await promiseRaceWithTimeout([
           fetch('/api/slow'),
           fetch('/api/fast')
       ], 5000);
   } catch (error) {
       console.log('–í—Å–µ –ø—Ä–æ–º–∏—Å—ã –ª–∏–±–æ —É–ø–∞–ª–∏, –ª–∏–±–æ –ø—Ä–µ–≤—ã—Å–∏–ª–∏ —Ç–∞–π–º–∞—É—Ç');
   }
   ```

4. **`promiseChain(tasks)`** - —Ü–µ–ø–æ—á–∫–∞ –∑–∞–≤–∏—Å–∏–º—ã—Ö –∑–∞–¥–∞—á
   ```javascript
   const result = await promiseChain([
       { name: 'auth', task: () => authenticate() },
       { name: 'user', task: (auth) => getUser(auth.userId) },
       { name: 'posts', task: (user) => getUserPosts(user.id) }
   ]);
   
   // result = { auth: {...}, user: {...}, posts: [...] }
   ```
---

## üìù –ó–∞–¥–∞—á–∞ 11: Error recovery –ø–∞—Ç—Ç–µ—Ä–Ω—ã

### –û–ø–∏—Å–∞–Ω–∏–µ
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –æ—à–∏–±–æ–∫.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
–ü—Ä–æ–±–ª–µ–º–∞: –°–µ—Ç–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –º–æ–≥—É—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –ø–∞–¥–∞—Ç—å. –ù—É–∂–µ–Ω —É–º–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –ø–æ–≤—Ç–æ—Ä–æ–≤.
fn - —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
options:
    maxAttempts - –º–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3)
    backoff - —Å—Ç—Ä–∞—Ç–µ–≥–∏—è: 'fixed', 'linear', 'exponential' (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 'exponential')
    initialDelay - –Ω–∞—á–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –≤ ms (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1000)
    maxDelay - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –≤ ms (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30000)
    shouldRetry - —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —Å—Ç–æ–∏—Ç –ª–∏ –ø–æ–≤—Ç–æ—Ä—è—Ç—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—Å–µ–≥–¥–∞ true)
    onRetry - callback –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–æ–≤—Ç–æ—Ä–µ

–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –∏ shouldRetry(error) === true –∏ –ø–æ–ø—ã—Ç–∫–∏ –Ω–µ –∏—Å—á–µ—Ä–ø–∞–Ω—ã:
    –í—ã–∑–≤–∞—Ç—å onRetry(attemptNumber, error)
    –ü–æ–¥–æ–∂–¥–∞—Ç—å —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
    –ü–æ–≤—Ç–æ—Ä–∏—Ç—å
–ï—Å–ª–∏ —É—Å–ø–µ—Ö –∏–ª–∏ –ø–æ–ø—ã—Ç–∫–∏ –∏—Å—á–µ—Ä–ø–∞–Ω—ã - –≤–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç/–æ—à–∏–±–∫—É

1. **`withRetry(fn, options)`** - –≥–∏–±–∫–∏–µ –ø–æ–≤—Ç–æ—Ä—ã —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏
   ```javascript
   const result = await withRetry(unreliableFunction, {
       maxAttempts: 5,
       backoff: 'exponential', // 'linear', 'exponential', 'fixed'
       initialDelay: 1000,
       maxDelay: 30000,
       shouldRetry: (error) => error.code === 'NETWORK_ERROR',
       onRetry: (attempt, error) => console.log(`–ü–æ–ø—ã—Ç–∫–∞ ${attempt}: ${error.message}`)
   });
   ```
### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
    primary - –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–º–∏—Å)
    fallback - —Ä–µ–∑–µ—Ä–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–º–∏—Å)

    –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å primary()
    –ï—Å–ª–∏ primary –≤—ã–ø–æ–ª–Ω–∏–ª–∞—Å—å —É—Å–ø–µ—à–Ω–æ - –≤–µ—Ä–Ω—É—Ç—å –µ—ë —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    –ï—Å–ª–∏ primary —É–ø–∞–ª–∞ —Å –æ—à–∏–±–∫–æ–π - –≤—ã–ø–æ–ª–Ω–∏—Ç—å fallback()
    –ï—Å–ª–∏ fallback —Ç–æ–∂–µ —É–ø–∞–ª–∞ - –ø—Ä–æ–±—Ä–æ—Å–∏—Ç—å –æ—à–∏–±–∫—É –æ—Ç fallback

2. **`withFallback(primary, fallback)`** - fallback –∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–º—É –∏—Å—Ç–æ—á–Ω–∏–∫—É
   ```javascript
   const data = await withFallback(
       () => fetch('/api/primary'),
       () => fetch('/api/backup')
   );
   ```
### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
fn - —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞—â–∏—Ç—ã
options:
    threshold - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5)
    timeout - –≤—Ä–µ–º—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –≤ ms (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 60000)
    resetTimeout - –≤—Ä–µ–º—è –¥–æ –ø–æ–ø—ã—Ç–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≤ ms (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30000)
CLOSED (–∑–∞–º–∫–Ω—É—Ç) - –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–ø—Ä–æ—Å—ã
OPEN (—Ä–∞–∑–æ–º–∫–Ω—É—Ç) - –º–Ω–æ–≥–æ –æ—à–∏–±–æ–∫, –±–ª–æ–∫–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å—ã
HALF_OPEN (–ø–æ–ª—É–æ—Ç–∫—Ä—ã—Ç) - –ø—Ä–æ–±—É–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è
–í —Å–æ—Å—Ç–æ—è–Ω–∏–∏ CLOSED: –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ñ—É–Ω–∫—Ü–∏—é, —Å—á–∏—Ç–∞—Ç—å –æ—à–∏–±–∫–∏
–í —Å–æ—Å—Ç–æ—è–Ω–∏–∏ OPEN: —Å—Ä–∞–∑—É –∫–∏–¥–∞—Ç—å –æ—à–∏–±–∫—É "Circuit breaker is OPEN"
–í —Å–æ—Å—Ç–æ—è–Ω–∏–∏ HALF_OPEN: –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å, –µ—Å–ª–∏ —É—Å–ø–µ—Ö ‚Üí CLOSED, –µ—Å–ª–∏ –æ—à–∏–±–∫–∞ ‚Üí OPEN

3. **`withCircuitBreaker(fn, options)`** - circuit breaker –ø–∞—Ç—Ç–µ—Ä–Ω
   ```javascript
   const protected = withCircuitBreaker(unreliableService, {
       threshold: 5,        // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è
       timeout: 60000,      // –í—Ä–µ–º—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
       resetTimeout: 30000  // –í—Ä–µ–º—è –¥–æ –ø–æ–ø—ã—Ç–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
   });
   ```

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
    fn - –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
    healthFn - —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç true/false –∏–ª–∏ –ø—Ä–æ–º–∏—Å)
–ß—Ç–æ –¥–æ–ª–∂–Ω–∞ –¥–µ–ª–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—è:
    –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å healthFn() –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    –ï—Å–ª–∏ healthFn() –≤–µ—Ä–Ω—É–ª–∞ true - –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
    –ï—Å–ª–∏ healthFn() –≤–µ—Ä–Ω—É–ª–∞ false - –∫–∏–Ω—É—Ç—å –æ—à–∏–±–∫—É "Health check failed"
    –ï—Å–ª–∏ healthFn() —É–ø–∞–ª–∞ —Å –æ—à–∏–±–∫–æ–π - –ø—Ä–æ–±—Ä–æ—Å–∏—Ç—å —ç—Ç—É –æ—à–∏–±–∫—É

4. **`withHealthCheck(fn, healthFn)`** - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å–æ—Å—Ç–æ—è–Ω–∏—è
   ```javascript
   const result = await withHealthCheck(
       () => databaseQuery(),
       () => checkDatabaseConnection()
   );
   ```
---

## üìù –ó–∞–¥–∞—á–∞ 12: Promise.withResolvers –∏ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

### –û–ø–∏—Å–∞–Ω–∏–µ
–ò–∑—É—á–∏—Ç—å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ Promise –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏ —Å–æ–∑–¥–∞—Ç—å advanced —É—Ç–∏–ª–∏—Ç—ã.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `Promise.withResolvers()` –ø–æ–ª–∏—Ñ–∏–ª**
   ```javascript
   function createDeferred() {
       // –í–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Promise.withResolvers
   }
   
   const { promise, resolve, reject } = createDeferred();
   
   setTimeout(() => resolve('–ì–æ—Ç–æ–≤–æ!'), 1000);
   const result = await promise;
   ```
### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
    executor - —Ñ—É–Ω–∫—Ü–∏—è –∫–∞–∫ –≤ –æ–±—ã—á–Ω–æ–º Promise, –Ω–æ –ø–æ–ª—É—á–∞–µ—Ç (resolve, reject, signal)
    signal - AbortSignal –æ—Ç AbortController

–ß—Ç–æ –¥–æ–ª–∂–Ω–∞ –¥–µ–ª–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—è:
    –í–µ—Ä–Ω—É—Ç—å –Ω–æ–≤—ã–π Promise
    –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ–º–∏—Å–∞:
    –ï—Å–ª–∏ signal.aborted === true - —Å—Ä–∞–∑—É reject —Å new Error('Aborted')
    –ò–Ω–∞—á–µ –¥–æ–±–∞–≤–∏—Ç—å listener –Ω–∞ —Å–æ–±—ã—Ç–∏–µ 'abort' —Å–∏–≥–Ω–∞–ª–∞
    –ü—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏ abort:
    –°–¥–µ–ª–∞—Ç—å reject —Å new Error('Aborted')
    –í—ã–∑–≤–∞—Ç—å executor —Å —Ç—Ä–µ–º—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏: resolve, reject, signal

2. **`createAbortablePromise(executor, signal)`** - –ø—Ä–æ–º–∏—Å —Å AbortController
   ```javascript
   const controller = new AbortController();
   createAbortablePromise((resolve, reject, signal) => {
    setTimeout(() => resolve('–î–∞–Ω–Ω—ã–µ'), 5000),
    controller.signal
   })

   ```

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
    executor - —Ñ—É–Ω–∫—Ü–∏—è –≤–∏–¥–∞ (resolve, reject, progress) => void
    progress - —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (–ø—Ä–∏–Ω–∏–º–∞–µ—Ç —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 1)

–ß—Ç–æ –¥–æ–ª–∂–Ω–∞ –¥–µ–ª–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—è:
    –í–µ—Ä–Ω—É—Ç—å –æ–±—ä–µ–∫—Ç-–ø—Ä–æ–º–∏—Å —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º –º–µ—Ç–æ–¥–æ–º onProgress
    –ú–µ—Ç–æ–¥ onProgress(callback):
    –ü—Ä–∏–Ω–∏–º–∞–µ—Ç callback —Ñ—É–Ω–∫—Ü–∏—é
    Callback –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑ –∫–æ–≥–¥–∞ executor –≤—ã–∑—ã–≤–∞–µ—Ç progress(value)
    –ú–æ–∂–Ω–æ –ø–æ–¥–ø–∏—Å–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ listeners

–ü—Ä–æ–º–∏—Å –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –æ–±—ã—á–Ω—ã–π - –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å await, then, catch

3. **`promiseWithProgress(executor)`** - –ø—Ä–æ–º–∏—Å —Å –æ—Ç—á–µ—Ç–æ–º –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ
   ```javascript
   const promise = promiseWithProgress((resolve, reject, progress) => {
       let completed = 0;
       const total = 100;
       
       const interval = setInterval(() => {
           completed += 10;
           progress(completed / total);
           
           if (completed >= total) {
               clearInterval(interval);
               resolve('–ó–∞–≤–µ—Ä—à–µ–Ω–æ!');
           }
       }, 100);
   });
   
   promise.onProgress((ratio) => {
       console.log(`–ü—Ä–æ–≥—Ä–µ—Å—Å: ${Math.round(ratio * 100)}%`);
   });
   
   const result = await promise;
   ```

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
    dependencies - –æ–±—ä–µ–∫—Ç, –≥–¥–µ –∫–∞–∂–¥—ã–π –∫–ª—é—á —ç—Ç–æ:
    –§—É–Ω–∫—Ü–∏—è –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π: () => promise
    –ú–∞—Å—Å–∏–≤ —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏: [dep1, dep2, ..., (—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã) => promise]
–ß—Ç–æ –¥–æ–ª–∂–Ω–∞ –¥–µ–ª–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—è:
–í–µ—Ä–Ω—É—Ç—å –æ–±—ä–µ–∫—Ç —Å –º–µ—Ç–æ–¥–æ–º execute()

–ú–µ—Ç–æ–¥ execute():
    –í—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞—á–∏ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (—Å —É—á–µ—Ç–æ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
    –ü–∞—Ä–∞–ª–ª–µ–ª–∏—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –∑–∞–¥–∞—á–∏
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –≤—Å–µ—Ö –∑–∞–¥–∞—á
–õ–æ–≥–∏–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:
    –ó–∞–¥–∞—á–∞ –º–æ–∂–µ—Ç –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –¥—Ä—É–≥–∏—Ö –ø–æ –∏–º–µ–Ω–∏
    –ó–∞–≤–∏—Å–∏–º—ã–µ –∑–∞–¥–∞—á–∏ –ø–æ–ª—É—á–∞—é—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Ö, –æ—Ç –∫–æ–≥–æ –∑–∞–≤–∏—Å—è—Ç

4. **`createPromiseTree(dependencies)`** - –¥–µ—Ä–µ–≤–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
   ```javascript
   const tree = createPromiseTree({
       a: () => fetchA(),
       b: ['a', (a) => fetchB(a)],
       c: ['a', (a) => fetchC(a)],
       d: ['b', 'c', (b, c) => fetchD(b, c)]
   });
   
   const results = await tree.execute();
   // { a: resultA, b: resultB, c: resultC, d: resultD }
   ```
